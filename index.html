<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Steam Family Library</title>

<style>
  :root{
    --bg:#0b1218;
    --panel:#111a24;
    --muted:#8fa3b7;
    --accent:#1b8ad1;
    --card-radius:12px;
    --card-gap:18px;
  }
  html,body{margin:0;font-family:Inter, system-ui;background:var(--bg);color:#e6eef6;}

  header{
    display:flex;align-items:center;gap:16px;
    padding:20px 28px;
    border-bottom:1px solid rgba(255,255,255,0.04);
  }
  .logo{display:flex;gap:12px;align-items:center;}
  .logo .mark{
    width:44px;height:44px;border-radius:8px;
    background:linear-gradient(180deg,var(--accent),#0b67a4);
    display:flex;align-items:center;justify-content:center;
    font-weight:700;font-size:18px;color:white;
  }
  h1{margin:0;font-size:18px;font-weight:600;}

  main{padding:28px;max-width:1250px;margin:0 auto;}
  .grid{
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap:var(--card-gap);
  }

  .game-card{
    background:rgba(255,255,255,0.03);
    border-radius:var(--card-radius);
    padding:8px;
    position:relative;
    transition:transform .12s, box-shadow .12s;
    cursor:pointer;
  }
  .game-card:hover{
    transform:translateY(-6px);
    box-shadow:0 10px 30px rgba(2,8,20,0.6);
  }

  .poster{
    width:100%;
    aspect-ratio:2/3;
    border-radius:10px;
    overflow:hidden;
  }
  .poster img{
    width:100%;height:100%;object-fit:cover;
  }

  .meta{text-align:center;padding:10px 6px 14px;}
  .name{font-weight:600;font-size:14px;margin-bottom:8px;}
  .copies{font-size:13px;color:var(--muted);}

  .toolbox{
    position:absolute;left:10px;right:10px;bottom:12px;
    background:rgba(8,12,18,0.9);
    padding:8px;border-radius:10px;
    opacity:0;pointer-events:none;
    transform:translateY(10px);
    transition:.12s;
    display:flex;gap:8px;flex-wrap:wrap;
  }
  .game-card:hover .toolbox{
    opacity:1;pointer-events:auto;transform:translateY(0);
  }

  .owner{display:flex;gap:8px;align-items:center;}
  .owner img{width:34px;height:34px;border-radius:50%;object-fit:cover;}
  .o-name{font-size:13px;max-width:90px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}

  .loader,.error{text-align:center;padding:20px;}
  .error{color:#ffb4b4;}
</style>
</head>

<body>
<header>
  <div class="logo">
    <div class="mark">SF</div>
    <h1>Steam Family Library</h1>
  </div>
</header>

<main>
  <div id="loader" class="loader">Chargementâ€¦</div>
  <div id="error" class="error" style="display:none;"></div>
  <div id="grid" class="grid" style="display:none;"></div>
</main>

<script>
const STEAM_IDS = [
  "76561199797208434",
  "76561199428937867",
  "76561199208559725",
  "76561198342426856",
  "76561199683287336",
  "76561198788807590"
];

// ton domaine Render
const BASE = "https://steam-family.onrender.com/api";

// ðŸ”µ GET PROFILS
async function getPlayerInfo(ids){
  const r = await fetch(`${BASE}/players?steamids=${ids.join(",")}`);
  if(!r.ok) throw new Error("Ã‰chec /api/players : " + r.status);
  return r.json();
}

// ðŸ”µ GET JEUX Dâ€™UN JOUEUR
async function getOwnedGames(id){
  const r = await fetch(`${BASE}/ownedgames?steamid=${id}`);
  if(!r.ok) throw new Error("Ã‰chec /api/ownedgames : " + r.status);
  return r.json();
}

// ðŸ”µ IMAGE VERTICALE OFFICIELLE STEAM
function image(appid){
  return `https://cdn.cloudflare.steamstatic.com/steam/apps/${appid}/library_600x900.jpg`;
}

(async()=>{
  const loader=document.getElementById("loader");
  const error=document.getElementById("error");
  const grid=document.getElementById("grid");

  try{
    // 1) Charger profils
    const players = await getPlayerInfo(STEAM_IDS);
    const byId={};
    (players.response.players || []).forEach(p=>byId[p.steamid]=p);

    // 2) Charger bibliothÃ¨ques
    const libs = await Promise.all(
      STEAM_IDS.map(async id=>{
        const res = await getOwnedGames(id);
        return { id, games: res.response.games || [] };
      })
    );

    // 3) Fusionner en une seule liste {appid : {owners}}
    const combined = new Map();
    for(const lib of libs){
      for(const g of lib.games){
        if(!combined.has(g.appid))
          combined.set(g.appid, {name:g.name, owners:new Set()});
        combined.get(g.appid).owners.add(lib.id);
      }
    }

    loader.style.display="none";
    grid.style.display="grid";

    // 4) Affichage
    for(const [appid,data] of combined){
      const card=document.createElement("div");
      card.className="game-card";

      const poster=document.createElement("div");
      poster.className="poster";
      poster.innerHTML=`<img src="${image(appid)}">`;

      const meta=document.createElement("div");
      meta.className="meta";
      meta.innerHTML=`
        <div class="name">${data.name}</div>
        <div class="copies">${data.owners.size} copies</div>
      `;

      const toolbox=document.createElement("div");
      toolbox.className="toolbox";

      data.owners.forEach(id=>{
        const p=byId[id] || {personaname:id, avatarfull:""};
        const owner=document.createElement("div");
        owner.className="owner";
        owner.innerHTML=`
          <img src="${p.avatarfull}">
          <div class="o-name">${p.personaname}</div>
        `;
        toolbox.appendChild(owner);
      });

      card.appendChild(poster);
      card.appendChild(meta);
      card.appendChild(toolbox);
      grid.appendChild(card);
    }

  }catch(e){
    loader.style.display="none";
    error.style.display="block";
    error.textContent="Erreur : " + e;
  }
})();
</script>

</body>
</html>
